jnf={};jnf.d=document;jnf.w=window;jnf.loc=jnf.d.location.href;jnf.ua=navigator.userAgent.toLowerCase();jnf.is_quirks=jnf.d.compatMode&&jnf.d.compatMode=='BackCompat'?1:0;jnf.gEBI=function(arg){if(typeof arg=='object')return arg;else if(typeof arg=='string')return this.d.getElementById(arg);};jnf.gEBTN=function(name){return this.d.getElementsByTagName(name);};jnf.f=function(name){if(typeof(name)=='object')return name;else if(typeof(name)=='string')return this.d.forms[name+':form'];};jnf.fr=function(name){this.f(name).reset();};jnf.fs=function(name){this.f(name).submit();};jnf.fga=function(form){return this.f(name).action;};jnf.fsa=function(form,action){this.f(name).action=action;};jnf.fe=function(element){var name=element.split('[')[0];return this.f(name).elements[element];};jnf.fef=function(element){var name=element.split('[')[0];this.f(name).elements[element].focus();};jnf.fer=function(element){var name=element.split('[')[0];this.f(name).elements[element].value='';};jnf.fegv=function(element){var name=element.split('[')[0];return this.f(name).elements[element].value;};jnf.fesv=function(element,value){var name=element.split('[')[0];this.f(name).elements[element].value=value;};jnf.gcN=function(id){return this.gEBI(id).className;};jnf.scN=function(id,cname){this.gEBI(id).className=cname;};jnf.rcN=function(id){this.gEBI(id).className='';};jnf.giHTML=function(id){return this.gEBI(id).innerHTML;};jnf.siHTML=function(id,html){this.gEBI(id).innerHTML=html;};jnf.riHTML=function(id){this.gEBI(id).innerHTML='';};jnf.gAtt=function(id,att){return this.gEBI(id).getAttribute(att);};jnf.sAtt=function(id,att,value){this.gEBI(id).setAttribute(att,value);};jnf.rAtt=function(id,att){this.sAtt(id,att,'');};jnf.val_email=function(email){var reg=/^[a-zA-Z0-9_\-\.]+\@[a-zA-Z0-9\-\.]+\.[a-zA-Z0-9\-\.]+$/;return reg.test(email);};jnf.val_phone=function(phone){var reg1=/[0-9]{1}.*[0-9]{1}.*[0-9]{1}.*[0-9]{1}.*[0-9]{1}/;var reg2=/^\+?[0-9\(\)\-\. ]+$/;return(phone&&phone.toString().length<=20&&reg1.test(phone)&&reg2.test(phone))?true:false;};jnf.val_password=function(password){if(password.length<5)return false;else if(!/[0-9]+/.test(password))return false;else if(!/[a-z]+/.test(password))return false;else if(!/[A-Z]+/.test(password))return false;else return true;};jnf.val_host=function(host){var reg=/^(http|https):\/\/[a-z0-9\-\.]*\.[a-z]{2,4}\/{0,}$/i;return reg.test(host);};jnf.enter=function(event){return(event.keyCode==13)?true:false;};jnf.ctrlenter=function(event){return(event.ctrlKey&&(event.keyCode==13||event.keyCode==10 ))?true:false;};jnf.trim=function(value){if(value==null)return '';return value.toString().replace(/^\s+/,'').replace(/\s+$/,'');};jnf.empty=function(value){return(!jnf.trim(value))?true:false;};jnf.tz_offset=function(){var tz_offset=(new Date()).getTimezoneOffset() * -1;return tz_offset;};jnf.show=function(id){this.cname.del(id,'hidden');};jnf.hide=function(id){this.cname.add(id,'hidden');};jnf.showhide=function(id){if(this.cname.has(id,'hidden')) this.cname.del(id,'hidden');else this.cname.add(id,'hidden');};jnf.hidden=function(id){return this.cname.has(id,'hidden');};jnf.slide=function(id){$('#'+id).slideToggle(400);};jnf.active=function(arg){var object=this.gEBI(arg),cname;if(!object)return;cname=object.className;object.className=cname.replace('this','');cname=object.className;object.className=cname+' this';};jnf.inactive=function(arg){var object=this.gEBI(arg),cname;if(!object)return;cname=object.className;object.className=cname.replace('this','');};jnf.fail=function(arg){var object=this.gEBI(arg),cname;if(!object)return;cname=object.className;object.className=cname.replace('fail','');cname=object.className;object.className=cname+' fail';};jnf.unfail=function(arg){var object=this.gEBI(arg),cname;if(!object)return;cname=object.className;object.className=cname.replace('fail','');};jnf.enable=function(arg){var object=this.gEBI(arg);if(!object)return;object.disabled=false;};jnf.disable=function(arg){var object=this.gEBI(arg);if(!object)return;object.disabled=true;};jnf.cname={add:function(arg,name){var object=jnf.gEBI(arg);if(!object)return;if(this.has(object,name))return;var cname=object.className;object.className=(cname==''||/\s+$/.test(cname))?cname+name:cname+' '+name;},del:function(arg,name){var object=jnf.gEBI(arg);if(!object)return;if(!this.has(object,name))return;for(null;this.has(arg,name);null){var cname=object.className;var reg=new RegExp('\\s'+name+'\\s');object.className=(' '+cname+' ').replace(reg,' ').replace(/^ /,'').replace(/ $/,'');}},has:function(arg,name){var object=jnf.gEBI(arg);if(!object)return;var cname=object.className;var reg=new RegExp('\\s'+name+'\\s');return reg.test(' '+cname+' ');}};jnf.nocache=function(){var date=new Date();return date.getTime();};jnf.go=function(url){this.d.location.href=url||this.loc;};jnf.go2=function(url){this.w.open(url,'_blank');};jnf.go3=function(url){this.d.location.replace(url||this.loc);};jnf.encode=function(string){return encodeURIComponent(string);};jnf.decode=function(string){return decodeURIComponent(string);};jnf.serialize=function(form){var parts=[];var field=null;for(var i=0,l=form.elements.length;i<l;i++){field=form.elements[i];switch(field.type){case 'select-one':case 'select-multiple':for(var j=0,optLen=field.options.length;j<optLen;j++){var option=field.options[j];if(field.name&&option.selected){var optValue='';if(option.hasAttribute) optValue=(option.hasAttribute('value')?option.value:option.text);else optValue=(option.attributes['value'].specified?option.value:option.text);parts.push(encodeURIComponent(field.name)+'='+encodeURIComponent(optValue));}} break;case undefined:case 'file':case 'submit':case 'reset':case 'button':break;case 'radio':case 'checkbox':if(!field.checked) break;default:if(field.name&&field.getAttribute('data-no-serialize')===null) parts.push(encodeURIComponent(field.name)+'='+encodeURIComponent(field.value));}}return parts.join('&');};jnf.xhr=function(){if(window.XMLHttpRequest)return new XMLHttpRequest();else if(window.ActiveXObject)return new ActiveXObject('Microsoft.XMLHTTP');else return null;};jnf.ajax=function(url,options){options=options||{};if(options.nocache) url=url+(/\?/.test(url)?'&':'?' )+'_='+new Date().getTime();var xhr=options.xhr||this.xhr(),method=options.method||'get',params=options.params||null,async=(options.async||options.async===undefined)?true:false;xhr.open(method,url,async);if(method=='post') xhr.setRequestHeader('Content-type','application/x-www-form-urlencoded');xhr.onreadystatechange=function(event){if(xhr.readyState==4){xhr.working=false;if((xhr.status>=200&&xhr.status<300)||xhr.status==304){if(options.callback) options.callback(xhr.responseText,true,xhr);}else{try{console.log('XHR failed with status: '+xhr.status);}catch(e) {};if(options.callback) options.callback(xhr.responseText,false,xhr);}}};xhr.working=true;xhr.send(params);return xhr;};jnf.json={parse:function(string){try{if(window.JSON)return JSON.parse(string);else return eval('('+string+')');}catch(e){try{console.log('JSON parse failed for string: '+string);}catch(e) {};return{json_parse_failed:true };}},stringify:function(object){try{return JSON.stringify(object);}catch(e){try{console.log('JSON parse failed for object: '+object);}catch(e) {};}}};jnf.back=function(){history.back();};jnf.in_array=function(needle,haystack){for(var k in haystack){if(haystack[k]==needle)return true;}return false;};jnf.array_key_exists=function(key,haystack){for(var k in haystack){if(k==key)return true;}return false;};jnf.array_flip=function(haystack){var tmp={};for(var k in haystack){if(!haystack.hasOwnProperty(k)) continue;tmp[haystack[k]]=k;}return tmp;};jnf.cookie={get: function(name){var cookie_str=document.cookie,cookie_name=encodeURIComponent(name)+'=',cookie_start=cookie_str.indexOf(cookie_name),cookie_value=null;if(cookie_start>0){cookie_name=' '+encodeURIComponent(name)+'=';cookie_start=cookie_str.indexOf(cookie_name);}if(cookie_start>-1){var cookie_end=cookie_str.indexOf(';',cookie_start);if(cookie_end==-1) cookie_end=cookie_str.length;cookie_value=decodeURIComponent(cookie_str.substring(cookie_start+cookie_name.length,cookie_end));}return cookie_value;},set: function(name,value,expires,path,domain,secure){var cookie_text=encodeURIComponent(name)+'='+encodeURIComponent(value);if(typeof expires=='number'){var date=new Date();date.setDate(date.getDate()+expires);cookie_text+=';expires='+date.toUTCString();}else if(expires instanceof Date) cookie_text+=';expires='+expires.toGMTString();cookie_text+=(path)?';path='+path:';path=/';if(domain) cookie_text+=';domain='+domain;if(secure) cookie_text+=';secure';document.cookie=cookie_text;},unset: function(name,path,domain,secure){this.set(name,'',new Date(0),path,domain,secure);}};jnf.subcookie={get: function(name,sub_name){var sub_cookies=this.get_all(name);return(sub_cookies)?sub_cookies[sub_name]:null;},get_all: function(name){var cookie_str=document.cookie,cookie_name=encodeURIComponent(name)+'=',cookie_start=cookie_str.indexOf(cookie_name),cookie_value=null,result={};if(cookie_start>0){cookie_name=' '+encodeURIComponent(name)+'=';cookie_start=cookie_str.indexOf(cookie_name);}if(cookie_start>-1){var cookie_end=cookie_str.indexOf(';',cookie_start);if(cookie_end==-1) cookie_end=cookie_str.length;cookie_value=cookie_str.substring(cookie_start+cookie_name.length,cookie_end);if(cookie_value.length>0){var sub_cookies=cookie_value.split('&');for(var i=0,len=sub_cookies.length;i<len;i++){var parts=sub_cookies[i].split('=');result[decodeURIComponent(parts[0])]=decodeURIComponent(parts[1]);}return result;}}return [];},set: function(name,sub_name,value,expires,path,domain,secure){var sub_cookies=this.get_all(name)||{};sub_cookies[sub_name]=value;this.set_all(name,sub_cookies,expires,path,domain,secure);},set_all: function(name,sub_cookies,expires,path,domain,secure){var cookie_text=encodeURIComponent(name)+'=';var sub_cookie_parts=[];for(var sub_name in sub_cookies){if(sub_name.length>0&&sub_cookies.hasOwnProperty(sub_name)) sub_cookie_parts.push(encodeURIComponent(sub_name)+'='+encodeURIComponent(sub_cookies[sub_name]));}if(sub_cookie_parts.length>0){cookie_text+=sub_cookie_parts.join('&');if(typeof expires=='number'){var date=new Date();date.setDate(date.getDate()+expires);cookie_text+=';expires='+date.toUTCString();}else if(expires instanceof Date) cookie_text+=';expires='+expires.toGMTString();cookie_text+=(path)?';path='+path:';path=/';if(domain) cookie_text+=';domain='+domain;if(secure) cookie_text+=';secure';}else{cookie_text+=";expires="+(new Date(0)).toGMTString();cookie_text+=(path)?';path='+path:';path=/';}document.cookie=cookie_text;},unset: function(name,sub_name,expires,path,domain,secure){var sub_cookies=this.get_all(name);if(sub_cookies){delete sub_cookies[sub_name];this.set_all(name,sub_cookies,expires,path,domain,secure);}},unset_all: function(name,path,domain,secure){this.set_all(name,null,new Date(0),path,domain,secure);}};jnf.browser={version: (jnf.ua.match( /.+(?:rv|it|ra|ie|me)[\/: ]([\d.]+)/ )||[])[1],chrome: /chrome/.test(jnf.ua),safari: /webkit/.test(jnf.ua)&&!/chrome/.test(jnf.ua),opera: /opera/.test(jnf.ua),firefox: /firefox/.test(jnf.ua),msie: /msie/.test(jnf.ua)&&!/opera/.test(jnf.ua),mozilla: /mozilla/.test(jnf.ua)&&!/(compatible|webkit)/.test(jnf.ua)};jnf.checkboxes={change: function(id,name){var elms=jnf.gEBI(id).getElementsByTagName('input');for(var i=0,l=elms.length;i<l;i++){if(elms[i].type=='checkbox'&&(!name||name==elms[i].name)) elms[i].checked=(elms[i].checked==true)?false:true;}},verify: function(id,name){var elms=jnf.gEBI(id).getElementsByTagName('input');for(var i=0,l=elms.length;i<l;i++){if(elms[i].type=='checkbox'&&elms[i].checked&&(!name||name==elms[i].name))return true;}return false;},implode: function(id,glue,name){var elms=jnf.gEBI(id).getElementsByTagName('input'),values='';for(var i=0,l=elms.length;i<l;i++){if(elms[i].type=='checkbox'&&elms[i].checked&&(!name||name==elms[i].name)) values+=glue+elms[i].value;}return values.substr(1);}};jnf.radios={verify: function(id,name){var elms=jnf.gEBI(id).getElementsByTagName('input');for(var i=0,l=elms.length;i<l;i++){if(elms[i].type=='radio'&&elms[i].checked&&(!name||name==elms[i].name))return true;}return false;},value: function(id,name){var elms=jnf.gEBI(id).getElementsByTagName('input');for(var i=0,l=elms.length;i<l;i++){if(elms[i].type=='radio'&&elms[i].checked&&(!name||name==elms[i].name))return elms[i].value;}return false;}};if(typeof JSON !=='object'){JSON={};}(function(){'use strict';function f(n){return n<10?'0'+n:n;}if(typeof Date.prototype.toJSON !=='function'){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+f(this.getUTCMonth()+1)+'-'+f(this.getUTCDate())+'T'+f(this.getUTCHours())+':'+f(this.getUTCMinutes())+':'+f(this.getUTCSeconds())+'Z':null;};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();};}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==='string'?c:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==='object' &&typeof value.toJSON==='function'){value=value.toJSON(key);}if(typeof rep==='function'){value=rep.call(holder,key,value);}switch(typeof value){case 'string':return quote(value);case 'number':return isFinite(value)?String(value):'null';case 'boolean':case 'null':return String(value);case 'object':if(!value){return 'null';}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==='[object Array]'){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||'null';}v=partial.length===0?'[]':gap?'[\n'+gap+partial.join(',\n'+gap)+'\n'+mind+']':'['+partial.join(',')+']';gap=mind;return v;}if(rep&&typeof rep==='object'){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==='string'){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?':':':')+v);}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?':':':')+v);}}}}v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+mind+'}':'{'+partial.join(',')+'}';gap=mind;return v;}}if(typeof JSON.stringify !=='function'){JSON.stringify=function(value,replacer,space){var i;gap='';indent='';if(typeof space==='number'){for(i=0;i<space;i+=1){indent+=' ';}}else if(typeof space==='string'){indent=space;}rep=replacer;if(replacer&&typeof replacer !=='function' &&(typeof replacer !=='object'||typeof replacer.length !=='number')){throw new Error('JSON.stringify');}return str('',{'':value});};}if(typeof JSON.parse !=='function'){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==='object'){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v !==undefined){value[k]=v;}else{delete value[k];}}}}return reviver.call(holder,key,value);}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return '\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);});}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''))){j=eval('('+text+')');return typeof reviver==='function'?walk({'':j},''):j;}throw new SyntaxError('JSON.parse');};}}());function ims_alert_open(type,message,autocloseoff){(typeof alert_close_timeout=='undefined')?null:clearTimeout(alert_close_timeout);jnf.scN('box_alert','messageInfo '+type);jnf.siHTML('box_alert',message);if(!autocloseoff) alert_close_timeout=setTimeout(function(){ims_alert_close();},8000);}function ims_alert_close(){close_boxes=false;(typeof alert_close_timeout=='undefined')?null:clearTimeout(alert_close_timeout);jnf.scN('box_alert','hidden');}function ims_alert_confirm(message,statement){alert_prompt_statement=statement;ims_alert_open('confirm','<p><span class="confirmI">'+MX['confirm']+'</span>'+message+'</p><input type="button" class="but" value="'+MX['yes']+'" onclick="ims_alert_close();eval(alert_prompt_statement);" /> &nbsp;&nbsp;<input type="button" class="but" value="'+MX['no']+'" onclick="ims_alert_close();" />');}function ims_alert_base(type,message,autocloseoff){message='<p><span class="'+type+'I">'+MX[type]+'</span>'+message+'</p><input type="button" class="but" value="'+MX['close']+'" onclick="ims_alert_close();" />';ims_alert_open(type,message,autocloseoff);}function ims_replace_after_exec(v){v=v.replace(/&lt;/gi,'<');v=v.replace(/&gt;/gi,'>');v=v.replace(/&amp;/gi,'&');v=v.replace(/<span><\/span>/gi,'');v=v.replace(/<(b|bold|strong)>(.*?)<\/(b|bold|strong)>/gi,'[b]$2[/b]');v=v.replace(/<(i|italic|em)>(.*?)<\/(i|italic|em)>/gi,'[i]$2[/i]');v=v.replace(/<u>(.*?)<\/u>/gi,'[u]$1[/u]');v=v.replace(/<s>(.*?)<\/s>/gi,'[s]$1[/s]');v=v.replace(/<span style="font-weight: bold;">(.*?)<\/span>/gi,'[b]$1[/b]');v=v.replace(/<span style="font-style: italic;">(.*?)<\/span>/gi,'[i]$1[/i]');v=v.replace(/<span style="text-decoration: underline;">(.*?)<\/span>/gi,'[u]$1[/u]');v=v.replace(/<span style="font-weight: bold;font-style: italic;">(.*?)<\/span>/gi,'[b][i]$1[/i][/b]');v=v.replace(/<span style="font-style: italic;font-weight: bold;">(.*?)<\/span>/gi,'[i][b]$1[/b][/i]');v=v.replace(/<span style="font-style: italic;text-decoration: underline;">(.*?)<\/span>/gi,'[i][u]$1[/u][/i]');v=v.replace(/<span style="text-decoration: underline;font-style: italic;">(.*?)<\/span>/gi,'[u][i]$1[/i][/u]');v=v.replace(/<span style="text-decoration: underline;font-weight: bold;">(.*?)<\/span>/gi,'[u][b]$1[/b][/u]');v=v.replace(/<span style="font-weight: bold;text-decoration: underline;">(.*?)<\/span>/gi,'[b][u]$1[/u][/b]');v=v.replace(/<span style="font-weight: bold;font-style: italic;text-decoration: underline;">(.*?)<\/span>/gi,'[b][i][u]$1[/u][/i][/b]');v=v.replace(/<span style="font-weight: bold;text-decoration: underline;font-style: italic;">(.*?)<\/span>/gi,'[b][u][i]$1[/i][/u][/b]');v=v.replace(/<span style="font-style: italic;font-weight: bold;text-decoration: underline;">(.*?)<\/span>/gi,'[i][b][u]$1[/u][/b][/i]');v=v.replace(/<span style="font-style: italic;text-decoration: underline;font-weight: bold;">(.*?)<\/span>/gi,'[i][u][b]$1[/b][/u][/i]');v=v.replace(/<span style="text-decoration: underline;font-weight: bold;font-style: italic;">(.*?)<\/span>/gi,'[u][b][i]$1[/i][/b][/u]');v=v.replace(/<span style="text-decoration: underline;font-style: italic;font-weight: bold;">(.*?)<\/span>/gi,'[u][i][b]$1[/b][/i][/u]');v=v.replace(/<\/p>\r\n<p>/gi,'\n');v=v.replace(/<p><br><\/p>/gi,'\n');v=v.replace(/<p>/gi,'\n');v=v.replace(/<\/p>/gi,'');v=v.replace(/<div><br><\/div>/gi,'\n');v=v.replace(/<div>(.*?)<\/div>/gi,'\n$1');v=v.replace(/<br[^>]*>/gi,'\n');v=v.replace(/&nbsp;/gi,'');v=v.replace(/<span[^>]*>(.*)<\/span[^>]*>/gi,'$1');v=v.replace(/\[(b|i|u|s)\]\n\[\/(b|i|u|s)\]/gi,'');return v;}
eclient={};eclient.dots={play:function(){if(this.timeout) this.stop();this.count=-1;this.run();},stop:function(){jnf.riHTML('js_request_dots');clearTimeout(this.timeout);},run:function(){this.count++;this.count=(this.count==4)?0:this.count;if(this.count==0) jnf.riHTML('js_request_dots');else{var i,dots='';for(i=1;i<=this.count;i++) dots+='.';jnf.siHTML('js_request_dots',dots);}this.timeout=setTimeout(function(){eclient.dots.run();},500);},reset:function(){this.stop();this.play();}};eclient.options={sounds:function(){if(jnf.gcN('play_sounds')=='soundOFF'){jnf.scN('play_sounds','soundON');jnf.subcookie.set(config.sname,'sound','ON',config.sexpires,config.spath);}else{jnf.scN('play_sounds','soundOFF');jnf.subcookie.set(config.sname,'sound','OFF',config.sexpires,config.spath);}},enter:function(){if(jnf.gcN('send_msg_with_enter')=='enterOFF'){jnf.scN('send_msg_with_enter','enterON');jnf.scN('chat_message','l textAreaEnter');jnf.hide('chat_button');jnf.subcookie.set(config.sname,'enter','ON',config.sexpires,config.spath);}else{jnf.scN('send_msg_with_enter','enterOFF');jnf.show('chat_button');jnf.scN('chat_message','l');jnf.subcookie.set(config.sname,'enter','OFF',config.sexpires,config.spath);}}};eclient.chat_box_status=function(message){message.gateway=config.gateway;message.uniqid=config.uniqid;message.page='chat';message.on_chat=true;if(!message.chat_status) message.chat_status='res';if(message.chat_status=='min'){jnf.hide('chat_header');jnf.show('chat_footer');jnf.gEBI('body').style.height='35px';eclient.xdc.set(parent,message);var chatstatus=jnf.subcookie.get(config.sname,'chatstatus');if(chatstatus=='max'||chatstatus=='res') jnf.subcookie.set(config.sname,'onchat',chatstatus,config.sexpires,config.spath);}else if(message.chat_status=='max'){jnf.show('chat_header');jnf.hide('chat_footer');jnf.hide('butt_max');jnf.show('butt_res');eclient.xdc.set(parent,message);setTimeout( function(){jnf.gEBI('body').style.height=(jnf.d.documentElement.clientHeight - 9)+'px';jnf.gEBI('content_chat_box').innerHTML+=' ';},200 );}else if(message.chat_status=='res'){jnf.show('chat_header');jnf.hide('chat_footer');jnf.gEBI('body').style.height='400px';jnf.show('butt_max');jnf.hide('butt_res');jnf.gEBI('content_chat_box').scrollTop=100000;eclient.xdc.set(parent,message);}jnf.subcookie.set(config.sname,'chatstatus',message.chat_status,config.sexpires,config.spath);jnf.gEBI('content_chat_box').innerHTML+=' ';};eclient.upload=function(){setTimeout(function(){new AjaxUpload('upload_chat_file_elm',{action: config.domain+'/'+config.account+'/client-embed/ajax.ims?session='+config.gateway+'&uniqid='+config.uniqid+'&language='+config.lang+'&tz_offset='+jnf.tz_offset()+(config.query?'&'+config.query:'')+(config.query?'&'+config.query:'')+'&action=upload_chat_file',name: 'file',title: MX[37],data:{MAX_FILE_SIZE: 2097152 },onChange: function(file,extension){var extensions=new Array('7z','doc','docx','gif','jpg','jpeg','odt','png','ppt','pptx','pps','pdf','rar','rtf','txt','xls','xlsx','zip');if(!jnf.in_array(extension,extensions)){alert(MX[74].replace('%s',extensions.join(',')));return false;}},onSubmit: function(){jnf.scN('upload_chat_file_elm','loader');},onComplete:function(file,response){jnf.scN('upload_chat_file_elm','fTxt');response=response.split('[LEVEL1]');if(response[0]=='ERROR') alert(response[1]);else if(response[0]=='OK'){var msg=jnf.gEBI('chat_message').value;jnf.gEBI('chat_message').value=response[1];eclient.chat.send(msg);}}});},1000);};eclient.typing={status:false,set:function(status,event){if(event&&event.keyCode==13)return;if(status){if(this.timeout) clearTimeout(this.timeout);this.timeout=setTimeout(function(){eclient.typing.set(false);},4000);}if(!this.status&&status) this.send(status);else if(this.status&&!status) this.send(status);},send:function(status){this.status=status;if(!config.fake_chat){if(!this.http) this.http=jnf.xhr();this.http.abort();this.http.open('get',config.domain+'/'+config.account+'/client-embed/ajax.ims?session='+config.gateway+'&uniqid='+config.uniqid+'&language='+config.lang+'&tz_offset='+jnf.tz_offset()+(config.query?'&'+config.query:'')+'&action=typing&status='+(status?1:0)+'&nocache='+jnf.nocache());this.http.send(null);}}};eclient.player=function(){eclient.player=new audioPlayer();};eclient.activity={status:true,send:function(){if(!config.activity)return;if(!this.status)return;if(config.on_chat&&!config.fake_chat)return;if(!this.http) this.http=jnf.xhr();this.http.abort();this.http.open('get',config.domain+'/'+config.account+'/client-embed/ajax.ims?session='+config.gateway+'&uniqid='+config.uniqid+'&language='+config.lang+'&tz_offset='+jnf.tz_offset()+(config.query?'&'+config.query:'')+'&action=activity&nocache='+jnf.nocache());this.http.onreadystatechange=function(){if(eclient.activity.http.readyState==4){var response=eclient.activity.http.responseText.split('[LEVEL1]');if((response[0]=='chat_fake'||response[0]=='chat_real')&&!config.on_chat){if(config.page=='mini') jnf.go3(config.domain+'/'+config.account+'/client-embed/'+config.lang+'/mini?session='+config.gateway+'&uniqid='+config.uniqid+(config.query?'&'+config.query:''));else if(config.page != 'offline'&&config.page != 'bye') jnf.go3(config.domain+'/'+config.account+'/client-embed/'+config.lang+'/chat?session='+config.gateway+'&uniqid='+config.uniqid+(config.query?'&'+config.query:''));}else if(response[0]=='chat_real'&&config.on_chat&&config.fake_chat){config.fake_chat=false;if(eclient.chat.last_message_time==0) eclient.chat.last_message_time=1;}else if(response[0]==''&&config.on_chat){jnf.go3(config.domain+'/'+config.account+'/client-embed/'+config.lang+'?session='+config.gateway+'&uniqid='+config.uniqid+(config.query?'&'+config.query:''));}else{eclient.activity.run();}}};this.http.send(null);},run:function(){if(this.timeout) clearTimeout(this.timeout);this.timeout=setTimeout(function(){eclient.activity.send();},5000);}};eclient.xdc=function(){var last_hash,attached_callback;return{set:function(obj,message){if(obj.postMessage){message=JSON.stringify(message);obj.postMessage(message,'*');}else{message._xrand=new Date().getMilliseconds();message._xisrc=document.location.href.split('#')[0];message=JSON.stringify(message);obj.location.href=config.purl+'#'+encodeURIComponent(message);}},get:function(callback,source_origin){if(window.postMessage){attached_callback=function(e){var regex=new RegExp('^'+e.origin.replace(/\./g,'\\.'),'g');if(source_origin != '*'&&!regex.test(source_origin))return false;callback(e);};if(window.addEventListener) window.addEventListener('message',attached_callback,false);else window.attachEvent('onmessage',attached_callback);}else{setInterval(function(){var hash=document.location.hash;if(!hash)return;if(hash != last_hash){last_hash=hash;hash=decodeURIComponent(hash.split('#')[1]);callback({data:hash});}},100);}},controller:function(){this.get(function(message){try{var data=JSON.parse(message.data);}catch(e){var data={};};if(data.cmd=='activity'){eclient.activity.status=data.status;eclient.activity.send();}if(data.cmd=='javascript'&&config.javascript){eval(data.code);if(window.lct_client_embed_window) eclient.xdc.set(lct_client_embed_window,data);}if(data.cmd=='chat_box_status'&&config.page=='chat'&&jnf.in_array(data.status,['min','res','max'])){if(data.status=='min') jnf.subcookie.set(config.sname,'msg',0,config.sexpires,config.spath);eclient.chat_box_status({event:'change',chat_status:data.status});}if(data.cmd=='bubble'){if(data.enable){jnf.show('box_ques');eclient.xdc.set(parent,{gateway:config.gateway,uniqid:config.uniqid,page:config.page,event:'change',hidden_ques:false});}else{jnf.hide('box_ques');eclient.xdc.set(parent,{gateway:config.gateway,uniqid:config.uniqid,page:config.page,event:'change',hidden_ques:true});}}if(data.cmd=='clone_operators'){if(window.lct_client_embed_window){eclient.xdc.set(lct_client_embed_window,data);return;}var clone=data.clone_operators;if(config.page=='online'&&jnf.gEBI('box_operators')){var departments=jnf.gEBI('box_operators').getElementsByTagName('strong');for(var operator_name in clone){for(var i=0;i<departments.length;i++){var operators=departments[i].parentNode.getElementsByTagName('li');for(var j=0;j<operators.length;j++){if(operators[j].getElementsByTagName('a')[0].innerHTML==operator_name){for(var k in clone[operator_name]){var department_name=clone[operator_name][k];var found=false;for(var l=0;l<departments.length;l++){if(departments[l].innerHTML==department_name){delete clone[operator_name][k];var li=document.createElement('li');li.innerHTML=operators[j].innerHTML;departments[l].parentNode.getElementsByTagName('ul')[0].appendChild(li);found=true;}}if(!found){delete clone[operator_name][k];var li=document.createElement('li');li.innerHTML='<strong>'+department_name+'</strong><ul><li>'+operators[j].innerHTML+'</li></ul>';jnf.gEBI('box_operators').appendChild(li);}}}}}} eclient.xdc.set(parent,{height:eclient.body_height()});}else if(config.page=='offline'&&jnf.fe('offline[operator_id]')){var departments=jnf.fe('offline[operator_id]').getElementsByTagName('optgroup');for(var operator_name in clone){for(var i=0;i<departments.length;i++){var operators=departments[i].getElementsByTagName('option');for(var j=0;j<operators.length;j++){if(operators[j].innerHTML==operator_name){for(var k in clone[operator_name]){var department_name=clone[operator_name][k];var found=false;for(var l=0;l<departments.length;l++){if(departments[l].getAttribute('label')==department_name){delete clone[operator_name][k];var option=document.createElement('option');option.innerHTML=operators[j].innerHTML;option.value=operators[j].value;departments[l].appendChild(option);found=true;}}if(!found){delete clone[operator_name][k];var optgroup=document.createElement('optgroup');optgroup.setAttribute('label',department_name);var option=document.createElement('option');option.innerHTML=operators[j].innerHTML;option.value=operators[j].value;optgroup.appendChild(option);jnf.fe('offline[operator_id]').appendChild(optgroup);}}}}}}}}if(data.cmd=='webrtc_close'){eclient.webrtc.close();}},'*');}};}();eclient.ques=function(page){var http=jnf.xhr();http.open('get',config.domain+'/'+config.account+'/client-embed/ajax.ims?session='+config.gateway+'&uniqid='+config.uniqid+'&language='+config.lang+'&tz_offset='+jnf.tz_offset()+(config.query?'&'+config.query:'')+'&action=ques&nocache='+jnf.nocache());http.send(null);jnf.hide('box_ques');eclient.xdc.set(parent,{gateway:config.gateway,uniqid:config.uniqid,page:page,event:'change',hidden_ques:true});};eclient.change_name=function(){var http=jnf.xhr();var name=prompt(MX[7],jnf.subcookie.get(config.sname,'name')||'');if(name==null)return;else if(jnf.empty(name)&&jnf.browser.safari)return;else if(jnf.empty(name))return eclient.change_name();http.abort();http.open('get',config.domain+'/'+config.account+'/client-embed/ajax.ims?session='+config.gateway+'&uniqid='+config.uniqid+'&language='+config.lang+'&tz_offset='+jnf.tz_offset()+(config.query?'&'+config.query:'')+'&action=change_name&name='+jnf.encode(name)+'&nocache='+jnf.nocache());http.onreadystatechange=function(){if(http.readyState==4){var response=http.responseText.split('[LEVEL1]');if(response[0]=='ERROR') alert(response[1]);else if(response[0]=='OK'){var ptags=jnf.gEBI('content_chat_box').getElementsByTagName('p'),stag,btag;for(var key in ptags){if(typeof ptags[key] != 'object') continue;stag=ptags[key].getElementsByTagName('strong')[0];btag=stag.getElementsByTagName('b')[0];if(btag) btag.innerHTML=response[1];}}}};http.send(null);};eclient.call={http:jnf.xhr(),elements:function(event){if(event=='init'){if(this.auto_assign=='disabled'){jnf.hide('butt_cls1');jnf.show('butt_cls2');jnf.hide('box_operators');jnf.show('box_create_call');if(config.page=='online') jnf.siHTML('op_inf_txt',MX[88]);}else{this.box_ques_cname=jnf.gEBI('box_ques').className;this.body_heigth=eclient.body_height();jnf.hide('box_ques');jnf.gEBI('body').style.height='auto';if(config.mobile) jnf.cname.add('body','bodyFullHeight');jnf.show('box_header');jnf.show('box_create_call');jnf.hide('footer_a1');jnf.show('footer_a2');jnf.gEBI('box_footer').className='footer footerColor';eclient.xdc.set(parent,{gateway:config.gateway,uniqid:config.uniqid,page:'online',event:'change',height:eclient.body_height()});}} else if(event=='back'){if(this.auto_assign=='disabled'){jnf.show('butt_cls1');jnf.hide('butt_cls2');jnf.show('box_operators');jnf.hide('box_create_call');if(config.page=='online') jnf.siHTML('op_inf_txt',MX[10]);}else{jnf.gEBI('box_ques').className=eclient.call.box_ques_cname;jnf.gEBI('body').style.height=this.body_heigth+'px';if(config.mobile) jnf.cname.del('body','bodyFullHeight');jnf.hide('box_header');jnf.hide('box_create_call');jnf.show('footer_a1');jnf.hide('footer_a2');jnf.gEBI('box_footer').className='footerStart footerColor';eclient.xdc.set(parent,{gateway:config.gateway,uniqid:config.uniqid,page:'start-online',event:'change',hidden_ques:/hidden/.test(this.box_ques_cname)});}}},create:function(auto_assign,operator_id){var required_data=eclient.required_data_before_chat();if(required_data.status=='cancel')return;else if(required_data.status=='repeat')return this.create(auto_assign,operator_id);this.auto_assign=auto_assign;this.elements('init');eclient.dots.play();jnf.siHTML('js_request',MX[6]);this.http.abort();this.http.open('get',config.domain+'/'+config.account+'/client-embed/ajax.ims?session='+config.gateway+'&uniqid='+config.uniqid+'&language='+config.lang+'&tz_offset='+jnf.tz_offset()+(config.query?'&'+config.query:'')+'&action=call_create&operator_id='+(operator_id||'')+'&name='+jnf.encode(required_data.name||'')+'&email='+jnf.encode(required_data.email||'')+'&phone='+jnf.encode(required_data.phone||'')+'&nocache='+jnf.nocache());this.http.onreadystatechange=function(){if(eclient.call.http.readyState==4){var response=eclient.call.http.responseText.split('[LEVEL1]');if(response[0]=='ERROR'||response[0]=='CONFIRM'){eclient.call.elements('back');eclient.dots.stop();jnf.riHTML('js_request');if(response[0]=='ERROR') alert(response[1]);else if(response[0]=='CONFIRM'&&confirm(response[1])) jnf.go3(config.domain+'/'+config.account+'/client-embed/'+config.lang+'/offline?session='+config.gateway+'&uniqid='+config.uniqid+(config.query?'&'+config.query:'')+'&page=offline');}else if(response[0]=='OK'){eclient.dots.reset();jnf.siHTML('js_request',MX[15]);eclient.call.check();}}};this.http.send(null);},cancel:function(){this.http.abort();this.http.open('get',config.domain+'/'+config.account+'/client-embed/ajax.ims?session='+config.gateway+'&uniqid='+config.uniqid+'&language='+config.lang+'&tz_offset='+jnf.tz_offset()+(config.query?'&'+config.query:'')+'&action=call_cancel&nocache='+jnf.nocache());this.http.onreadystatechange=function(){if(eclient.call.http.readyState==4){var response=eclient.call.http.responseText.split('[LEVEL1]');if(response[0]=='ERROR') alert(response[1]);else if(response[0]=='OK'){clearTimeout(eclient.call.timeout);eclient.call.elements('back');if(window.name=='lct_client_embed_window'){jnf.subcookie.unset(config.sname,'opened_popup',config.sexpires,config.spath);window.close();}}}};this.http.send(null);},check:function(){if(this.timeout) clearTimeout(this.timeout);this.http.abort();this.http.open('get',config.domain+'/'+config.account+'/client-embed/ajax.ims?session='+config.gateway+'&uniqid='+config.uniqid+'&language='+config.lang+'&tz_offset='+jnf.tz_offset()+(config.query?'&'+config.query:'')+'&action=call_check&&nocache='+jnf.nocache());this.http.onreadystatechange=function(){if(eclient.call.http.readyState==4){var response=eclient.call.http.responseText.split('[LEVEL1]');if(response[0]=='CANCEL'){clearTimeout(eclient.call.timeout);eclient.call.elements('back');}else if(response[0]=='ERROR'){clearTimeout(eclient.call.timeout);if(!config.fake_chat){eclient.call.elements('back');eclient.dots.stop();}alert(response[1]);}else if(response[0]=='CONFIRM'){clearTimeout(eclient.call.timeout);if(!config.fake_chat){eclient.call.elements('back');eclient.dots.stop();if(confirm(response[1])) jnf.go3(config.domain+'/'+config.account+'/client-embed/'+config.lang+'/offline?session='+config.gateway+'&uniqid='+config.uniqid+(config.query?'&'+config.query:'')+'&page=offline');else if(window.name=='lct_client_embed_window'){jnf.subcookie.unset(config.sname,'opened_popup',config.sexpires,config.spath);window.close();}} else if(response[2]){if(confirm(response[1])) jnf.go3(config.domain+'/'+config.account+'/client-embed/'+config.lang+'/offline?session='+config.gateway+'&uniqid='+config.uniqid+(config.query?'&'+config.query:'')+'&page=offline&message='+jnf.encode(response[2]));}} else if(response[0]=='ACCEPTED'){clearTimeout(eclient.call.timeout);if(!config.fake_chat) jnf.go3(config.domain+'/'+config.account+'/client-embed/'+config.lang+'/chat?session='+config.gateway+'&uniqid='+config.uniqid+(config.query?'&'+config.query:''));else{config.fake_chat=false;eclient.xdc.set(config.master,{event:'chat_start',initiator:response[1],ticket:response[2],gau_global_object_name:config.gau_global_object_name,gau_tracker_objects_names:config.gau_tracker_objects_names,gaea_chat_start:config.gaea_chat_start});}}}};this.http.send(null);this.timeout=setTimeout(function(){eclient.call.check();},config.refresh * 1000);},restore:function(auto_assign){this.auto_assign=auto_assign;if(config.page != 'chat'){this.elements('init');eclient.dots.play();jnf.siHTML('js_request',MX[15]);}this.check();if(eclient.chat.last_message_time==0) eclient.chat.last_message_time=1;}};eclient.chat={http1:jnf.xhr(),http2:jnf.xhr(),last_message_time:0,check:function(){if(this.timeout) clearTimeout(this.timeout);if(!config.fake_chat){this.http1.abort();this.http1.open('get',config.domain+'/'+config.account+'/client-embed/ajax.ims?session='+config.gateway+'&uniqid='+config.uniqid+'&language='+config.lang+'&tz_offset='+jnf.tz_offset()+(config.query?'&'+config.query:'')+'&action=chat&last_message_time='+this.last_message_time+'&tmp_msg='+jnf.encode(jnf.trim(jnf.gEBI('chat_message').value))+'&nocache='+jnf.nocache());this.http1.onreadystatechange=function(){if(eclient.chat.http1.readyState==4){var response=eclient.chat.http1.responseText.split('[LEVEL1]');if(response[0]=='Error: not on chat') jnf.go3(config.domain+'/'+config.account+'/client-embed/'+config.lang+'/start-online?session='+config.gateway+'&uniqid='+config.uniqid+(config.query?'&'+config.query:''));else if(response[0]=='ERROR') null;else if(response[0]=='OK'){if(response[1]&&response[2]){var last_message_time_temp=eclient.chat.last_message_time;eclient.chat.last_message_time=response[1];document.getElementById('content_chat_box').innerHTML+=response[2];document.getElementById('content_chat_box').scrollTop=100000;}if(response[3]){if(jnf.subcookie.get(config.sname,'chatstatus')=='min'){var msg_count=parseInt(jnf.subcookie.get(config.sname,'msg'))||0;msg_count++;jnf.subcookie.set(config.sname,'msg',msg_count,config.sexpires,config.spath);}if(jnf.gEBI('play_sounds').className=='soundON'){if(last_message_time_temp==0) setTimeout(function(){eclient.player.play(config.domain+'/sounds/'+response[3]);},500);else eclient.player.play(config.domain+'/sounds/'+response[3]);}}if(response[4]) jnf.show('typing_indicator');else jnf.hide('typing_indicator');if(response[5]){var split=response[5].split('[LEVEL2]');if(split[0]=='GRANT'){if(confirm(split[1])) eclient.webrtc.reply('accept');else eclient.webrtc.reply('reject');}else if(split[0]=='TIMEOUT'||split[0]=='BUSSY'||split[0]=='REJECTED') alert(split[1]);else if(split[0]=='ACTIVE'){if(window.opener) eclient.webrtc.script(split[1],split[2],'auto');else eclient.xdc.set(config.master,{event:'webrtc',status:'active',type:'auto',room:split[1],mode:split[2],lang:config.lang});}}}}};this.http1.send(null);}this.timeout=setTimeout(function(){eclient.chat.check();},config.refresh * 1000);},check_mini:function(){if(this.timeout) clearTimeout(this.timeout);if(!config.fake_chat&&!jnf.subcookie.get(config.sname,'opened_popup')){this.http1.abort();this.http1.open('get',config.domain+'/'+config.account+'/client-embed/ajax.ims?session='+config.gateway+'&uniqid='+config.uniqid+'&language='+config.lang+'&tz_offset='+jnf.tz_offset()+(config.query?'&'+config.query:'')+'&action=chat&last_message_time='+this.last_message_time+'&nocache='+jnf.nocache());this.http1.onreadystatechange=function(){if(eclient.chat.http1.readyState==4){var response=eclient.chat.http1.responseText.split('[LEVEL1]');if(response[0]=='Error: not on chat') jnf.go3(config.domain+'/'+config.account+'/client-embed/'+config.lang+'/mini?session='+config.gateway+'&uniqid='+config.uniqid+(config.query?'&'+config.query:''));else if(response[0]=='ERROR') null;else if(response[0]=='OK'){if(response[1]&&response[2]){var last_message_time_temp=eclient.chat.last_message_time;eclient.chat.last_message_time=response[1];}if(response[3]){var msg_count=parseInt(jnf.subcookie.get(config.sname,'msg'))||0;msg_count++;jnf.subcookie.set(config.sname,'msg',msg_count,config.sexpires,config.spath);if(jnf.subcookie.get(config.sname,'sound')=='ON'){if(last_message_time_temp==0) setTimeout(function(){eclient.player.play(config.domain+'/sounds/'+response[3]);},500);else eclient.player.play(config.domain+'/sounds/'+response[3]);}}}}};this.http1.send(null);}this.timeout=setTimeout(function(){eclient.chat.check_mini();},config.refresh * 1000);},send:function(backup){var message=jnf.trim(jnf.gEBI('chat_message').value);if(jnf.empty(message)){alert(MX[28]);return;}var required_data={};if(config.fake_chat&&this.last_message_time==0){required_data=eclient.required_data_before_chat();if(required_data.status=='cancel')return;else if(required_data.status=='repeat')return this.send();}if(this.sending)return;this.sending=true;this.http2.abort();this.http2.open('get',config.domain+'/'+config.account+'/client-embed/ajax.ims?session='+config.gateway+'&uniqid='+config.uniqid+'&language='+config.lang+'&tz_offset='+jnf.tz_offset()+(config.query?'&'+config.query:'')+'&action=send_chat_message&name='+jnf.encode(required_data.name||'')+'&email='+jnf.encode(required_data.email||'')+'&phone='+jnf.encode(required_data.phone||'')+'&message='+jnf.encode(message)+'&nocache='+jnf.nocache());this.http2.onreadystatechange=function(){if(eclient.chat.http2.readyState==4){eclient.chat.sending=false;var response=eclient.chat.http2.responseText.split('[LEVEL1]');if(response[0]=='Error: not on chat') jnf.go3(config.domain+'/'+config.account+'/client-embed/'+config.lang+'/start-online?session='+config.gateway+'&uniqid='+config.uniqid+(config.query?'&'+config.query:''));else if(response[0]=='ERROR') alert(response[1]);else if(response[0]=='CONFIRM'&&confirm(response[1])) jnf.go3(config.domain+'/'+config.account+'/client-embed/'+config.lang+'/offline?session='+config.gateway+'&uniqid='+config.uniqid+(config.query?'&'+config.query:'')+'&page=offline&message='+jnf.encode(message));else if(response[0]=='OK'){jnf.gEBI('chat_message').value=(backup)?backup:'';jnf.gEBI('chat_message').focus();jnf.gEBI('content_chat_box').innerHTML+=response[1];jnf.gEBI('content_chat_box').scrollTop=100000;if(eclient.chat.last_message_time==0) eclient.chat.last_message_time=1;if(response[2]=='call_check') eclient.call.check();else if(response[2]=='chat_check'&&config.fake_chat) config.fake_chat=false;}}};this.http2.send(null);},close:function(){this.http2.abort();this.http2.open('get',config.domain+'/'+config.account+'/client-embed/ajax.ims?session='+config.gateway+'&uniqid='+config.uniqid+'&language='+config.lang+'&tz_offset='+jnf.tz_offset()+(config.query?'&'+config.query:'')+'&action=close&nocache='+jnf.nocache());this.http2.onreadystatechange=function(){if(eclient.chat.http2.readyState==4){var response=eclient.chat.http2.responseText.split('[LEVEL1]');if(response[0]=='ERROR') alert(response[1]);else if(response[0]=='OK'){clearTimeout(eclient.chat.timeout);jnf.subcookie.unset(config.sname,'opened_popup',config.sexpires,config.spath);jnf.subcookie.set(config.sname,'msg',0,config.sexpires,config.spath);if(window.name=='lct_client_embed_window'&&!config.chat_rating) window.close();else if(config.fake_chat){if(window.name=='lct_client_embed_window') window.close();else jnf.go3(config.domain+'/'+config.account+'/client-embed/'+config.lang+'?session='+config.gateway+'&uniqid='+config.uniqid+(config.query?'&'+config.query:''));}else{eclient.xdc.set(parent,{event:'closedFromLivechatoo' });jnf.go3(config.domain+'/'+config.account+'/client-embed/'+config.lang+'/bye?session='+config.gateway+'&uniqid='+config.uniqid+(config.query?'&'+config.query:''));}}}};this.http2.send(null);},rating:function(rating_value){this.http2.abort();this.http2.open('get',config.domain+'/'+config.account+'/client-embed/ajax.ims?session='+config.gateway+'&uniqid='+config.uniqid+'&language='+config.lang+'&tz_offset='+jnf.tz_offset()+(config.query?'&'+config.query:'')+'&action=rating&rating_value='+rating_value+'&rating_text='+jnf.encode(jnf.gEBI('chat_rating_text').value)+'&nocache='+jnf.nocache());this.http2.onreadystatechange=function(){if(eclient.chat.http2.readyState==4){var response=eclient.chat.http2.responseText.split('[LEVEL1]');if(response[0]=='ERROR') alert(response[1]);else if(response[0]=='OK'){eclient.xdc.set(config.master,{event:'chat_rating',ticket:response[1],name:response[2],email:response[3]||undefined,phone:response[4]||undefined,operator_id:parseInt(response[5]),department_id:(response[6]?parseInt(response[6]):undefined),rating:rating_value,message:jnf.gEBI('chat_rating_text').value,gau_global_object_name:config.gau_global_object_name,gau_tracker_objects_names:config.gau_tracker_objects_names,gaea_chat_rating:config.gaea_chat_rating});if(window.name=='lct_client_embed_window'){jnf.subcookie.unset(config.sname,'opened_popup',config.sexpires,config.spath);window.close();}else jnf.go3(config.domain+'/'+config.account+'/client-embed/'+config.lang+'?session='+config.gateway+'&uniqid='+config.uniqid+(config.query?'&'+config.query:''));}}};this.http2.send(null);},no_rating:function(){this.http2.abort();this.http2.open('get',config.domain+'/'+config.account+'/client-embed/ajax.ims?session='+config.gateway+'&uniqid='+config.uniqid+'&language='+config.lang+'&tz_offset='+jnf.tz_offset()+(config.query?'&'+config.query:'')+'&action=no_rating&nocache='+jnf.nocache());this.http2.onreadystatechange=function(){if(eclient.chat.http2.readyState==4){var response=eclient.chat.http2.responseText.split('[LEVEL1]');if(response[0]=='OK'){if(window.name=='lct_client_embed_window'){jnf.subcookie.unset(config.sname,'opened_popup',config.sexpires,config.spath);window.close();}else jnf.go3(config.domain+'/'+config.account+'/client-embed/'+config.lang+'?session='+config.gateway+'&uniqid='+config.uniqid+(config.query?'&'+config.query:''));}}};this.http2.send(null);}};eclient.email=function(){var http=jnf.xhr();var email=prompt(MX[8],jnf.subcookie.get(config.sname,'email')||'');if(email==null)return;if(!jnf.val_email(email)){alert(MX[9]);return this.email();}http.open('get',config.domain+'/'+config.account+'/client-embed/ajax.ims?session='+config.gateway+'&uniqid='+config.uniqid+'&language='+config.lang+'&tz_offset='+jnf.tz_offset()+(config.query?'&'+config.query:'')+'&action=email&email='+jnf.encode(email)+'&nocache='+jnf.nocache());http.onreadystatechange=function(){if(http.readyState==4){var response=http.responseText.split('[LEVEL1]');if(response[0]=='ERROR') alert(response[1]);else if(response[0]=='OK') alert(response[1]);}};http.send(null);};eclient.send_offline_message=function(){var http=jnf.xhr();if(jnf.empty(jnf.fegv('offline[name]'))) alert(MX[7]);else if(jnf.empty(jnf.fegv('offline[email]'))) alert(MX[8]);else if(!jnf.val_email(jnf.fegv('offline[email]'))) alert(MX[9]);else if(jnf.fe('offline[phone]')&&jnf.empty(jnf.fegv('offline[phone]'))&&jnf.fe('offline[phone]').getAttribute('data-is-required')=='yes') alert(MX[92]);else if(jnf.fe('offline[phone]')&&!jnf.empty(jnf.fegv('offline[phone]'))&&!jnf.val_phone(jnf.fegv('offline[phone]'))) alert(MX[93]);else if(jnf.fe('offline[operator_id]')&&jnf.empty(jnf.fegv('offline[operator_id]'))) alert(MX[10]);else if(jnf.empty(jnf.fegv('offline[message]'))) alert(MX[28]);else{jnf.fe('offline[send]').disabled=true;http.abort();http.open('get',config.domain+'/'+config.account+'/client-embed/ajax.ims?session='+config.gateway+'&uniqid='+config.uniqid+'&language='+config.lang+'&tz_offset='+jnf.tz_offset()+(config.query?'&'+config.query:'')+'&action=send_offline_message&name='+jnf.encode(jnf.fegv('offline[name]'))+'&email='+jnf.encode(jnf.fegv('offline[email]'))+'&phone='+(jnf.fe('offline[phone]')?jnf.encode(jnf.fegv('offline[phone]')):'')+'&operator_id='+(jnf.fe('offline[operator_id]')?jnf.fegv('offline[operator_id]'):'')+'&message='+jnf.encode(jnf.fegv('offline[message]'))+'&nocache='+jnf.nocache());http.onreadystatechange=function(){if(http.readyState==4){jnf.fe('offline[send]').disabled=false;var response=http.responseText.split('[LEVEL1]');if(response[0]=='ERROR'){alert(response[1]);}else if(response[0]=='OK'){eclient.xdc.set(config.master,{event:'offline_message',name:jnf.fegv('offline[name]'),email:jnf.fegv('offline[email]'),phone:(jnf.fe('offline[phone]')?jnf.fegv('offline[phone]'):undefined),message:jnf.fegv('offline[message]'),operator_id:(jnf.fe('offline[operator_id]')?parseInt(jnf.fegv('offline[operator_id]')):undefined),gau_global_object_name:config.gau_global_object_name,gau_tracker_objects_names:config.gau_tracker_objects_names,gaea_offline_message:config.gaea_offline_message});jnf.fer('offline[message]');alert(response[1]);}}};http.send(null);}};eclient.ga=function(){_gaq=[];_gaq.push(['_setAccount','UA-24837737-2']);_gaq.push(['_trackPageview']);(function(){var ga=document.createElement('script');ga.type='text/javascript';ga.async=true;ga.src=('https:'==document.location.protocol?'https://ssl':'http://www')+'.google-analytics.com/ga.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(ga,s);})();};eclient.ga_event=function(category,action,label,value){var _gaq=window._gaq;if(_gaq&&typeof _gaq=='object'&&typeof _gaq.push=='function') _gaq.push(['_trackEvent',category,action,label,value]);};eclient.scookie=function(){jnf.subcookie.set(config.sname,'page',config.page,config.sexpires,config.spath);jnf.subcookie.set(config.sname,'gateway',config.gateway,config.sexpires,config.spath);jnf.subcookie.set(config.sname,'uniqid',config.uniqid,config.sexpires,config.spath);};eclient.body_height=function(){return document.getElementById('body').clientHeight;};eclient.page=function(page,params){var params_str='';if(typeof params=='object'){for(var key in params){if(!params.hasOwnProperty(key)) continue;params_str+='&params'+encodeURIComponent('['+key+']')+'='+encodeURIComponent(params[key]);}} jnf.go3(config.domain+'/'+config.account+'/client-embed/'+config.lang+'?session='+config.gateway+'&uniqid='+config.uniqid+(config.query?'&'+config.query:'')+'&page='+page+'&opener=embed'+params_str);};eclient.required_data_before_chat=function(){var data={};if(config.require_name&&jnf.empty(jnf.subcookie.get(config.sname,'name'))){var name=prompt(MX[7],'');if(name==null){eclient.xdc.set(config.master,{event:'require_name',accepted:false,gau_global_object_name:config.gau_global_object_name,gau_tracker_objects_names:config.gau_tracker_objects_names,gaea_require_name:config.gaea_require_name});data.status='cancel';return data;}else if(jnf.empty(name)&&jnf.browser.safari){eclient.xdc.set(config.master,{event:'require_name',accepted:false,gau_global_object_name:config.gau_global_object_name,gau_tracker_objects_names:config.gau_tracker_objects_names,gaea_require_name:config.gaea_require_name});data.status='cancel';return data;}else if(jnf.empty(name)){data.status='repeat';return data;}else{data.name=name;jnf.subcookie.set(config.sname,'name',name,config.sexpires,config.spath);eclient.xdc.set(config.master,{event:'require_name',accepted:true,name:name,gau_global_object_name:config.gau_global_object_name,gau_tracker_objects_names:config.gau_tracker_objects_names,gaea_require_name:config.gaea_require_name});}}if(config.require_email&&!jnf.val_email(jnf.subcookie.get(config.sname,'email'))){var email=prompt(MX[8],'');if(email==null){eclient.xdc.set(config.master,{event:'require_email',accepted:false,gau_global_object_name:config.gau_global_object_name,gau_tracker_objects_names:config.gau_tracker_objects_names,gaea_require_email:config.gaea_require_email});data.status='cancel';return data;}else if(!jnf.val_email(email)&&jnf.browser.safari){eclient.xdc.set(config.master,{event:'require_email',accepted:false,gau_global_object_name:config.gau_global_object_name,gau_tracker_objects_names:config.gau_tracker_objects_names,gaea_require_email:config.gaea_require_email});data.status='cancel';return data;}else if(!jnf.val_email(email)){data.status='repeat';return data;}else{data.email=email;jnf.subcookie.set(config.sname,'email',email,config.sexpires,config.spath);eclient.xdc.set(config.master,{event:'require_email',accepted:true,email:email,gau_global_object_name:config.gau_global_object_name,gau_tracker_objects_names:config.gau_tracker_objects_names,gaea_require_email:config.gaea_require_email});}}if(config.require_phone&&!jnf.val_phone(jnf.subcookie.get(config.sname,'phone'))){var phone=prompt(MX[92],'');if(phone==null){eclient.xdc.set(config.master,{event:'require_phone',accepted:false,gau_global_object_name:config.gau_global_object_name,gau_tracker_objects_names:config.gau_tracker_objects_names,gaea_require_phone:config.gaea_require_phone});data.status='cancel';return data;}else if(!jnf.val_phone(phone)&&jnf.browser.safari){eclient.xdc.set(config.master,{event:'require_phone',accepted:false,gau_global_object_name:config.gau_global_object_name,gau_tracker_objects_names:config.gau_tracker_objects_names,gaea_require_phone:config.gaea_require_phone});data.status='cancel';return data;}else if(!jnf.val_phone(phone)){data.status='repeat';return data;}else{data.phone=phone;jnf.subcookie.set(config.sname,'phone',phone,config.sexpires,config.spath);eclient.xdc.set(config.master,{event:'require_phone',accepted:true,phone:phone,gau_global_object_name:config.gau_global_object_name,gau_tracker_objects_names:config.gau_tracker_objects_names,gaea_require_phone:config.gaea_require_phone});}}return data;};eclient.center=function(timeout){if(!config.mobile)return;if(!timeout){eclient.center(true);setTimeout(function(){eclient.center(true);},10);setTimeout(function(){eclient.center(true);},50);if(window.addEventListener) window.addEventListener('resize',function(){eclient.center(true);},true);else if(window.attachEvent) window.attachEvent('onresize',function(){eclient.center(true);});return;}var h1=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;var h2=Math.max(jnf.gEBI('body').offsetWidth,jnf.gEBI('body').clientWidth);var di=Math.round((h1 - h2) / 2);di=(di<0)?0:di;jnf.gEBI('body').style.right=di+'px';};eclient.keyboard={init:function(){if(!config.mobile||!window.addEventListener||typeof window.orientation=='undefined')return;var name=jnf.gEBI('offline_name');var email=jnf.gEBI('offline_email');var phone=jnf.gEBI('offline_phone');name.onfocus=this.focus;email.onfocus=this.focus;if(phone) phone.onfocus=this.focus;name.onblur=this.blur;email.onblur=this.blur;if(phone) phone.onblur=this.blur;},focus:function(){jnf.hide('offline_message_box');offline_focus_active=true;setTimeout(function(){offline_height_old=window.innerHeight;window.addEventListener('resize',eclient.keyboard.resize);},500);},blur:function(){setTimeout(function(){if(!offline_focus_active) jnf.show('offline_message_box');},300);offline_focus_active=false;window.removeEventListener('resize',eclient.keyboard.resize);},resize:function(){offline_height_new=window.innerHeight;var diff=Math.abs(offline_height_old - offline_height_new);var perc=Math.round((diff / offline_height_old) * 100);if(perc>50) eclient.keyboard.blur();}};eclient.logo=function(){if(jnf.gEBI('footer_logo_home_link')) setTimeout(function(){jnf.gEBI('footer_logo_home_link').onclick=null;},2000);};eclient.webrtc={closed:false,script:function(room,mode,type){var basehref='https://videochat.livechatoo.com';if(!jnf.gEBI('parent_script')){onLctWebrtcScriptReady=function(){lctwebrtc.init_video_box(basehref,room,mode,config.lang);};var l=document.createElement('script');l.type='text/javascript';l.async=!0;l.id='parent_script',l.src=basehref+'/assets/js/parent.min.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(l,s);}else if(!jnf.gEBI('parent_container')&&(!this.closed||type=='click')) lctwebrtc.init_video_box(basehref,room,mode,config.lang);},invite:function(mode){if(!this.http) this.http=jnf.xhr();this.http.abort();this.http.open('get',config.domain+'/'+config.account+'/client-embed/ajax.ims?session='+config.gateway+'&uniqid='+config.uniqid+'&language='+config.lang+'&tz_offset='+jnf.tz_offset()+(config.query?'&'+config.query:'')+'&action=webrtc&event=invite&mode='+mode+'&nocache='+jnf.nocache());this.http.onreadystatechange=function(){if(eclient.webrtc.http.readyState==4){var response=eclient.webrtc.http.responseText.split('[LEVEL1]');if(response[0]=='OK') eclient.ga_event('Chat '+mode,'Invite',config.account);if(response[0]=='ERROR'||response[0]=='OK') alert(response[1]);else if(response[0]=='ACTIVE'){if(window.opener) eclient.webrtc.script(response[1],response[2],'click');else eclient.xdc.set(config.master,{event:'webrtc',status:'active',type:'click',room:response[1],mode:response[2],lang:config.lang});}}};this.http.send(null);},reply:function(event){if(!this.http) this.http=jnf.xhr();this.http.abort();this.http.open('get',config.domain+'/'+config.account+'/client-embed/ajax.ims?session='+config.gateway+'&uniqid='+config.uniqid+'&language='+config.lang+'&tz_offset='+jnf.tz_offset()+(config.query?'&'+config.query:'')+'&action=webrtc&event='+event+'&nocache='+jnf.nocache());this.http.onreadystatechange=function(){if(eclient.webrtc.http.readyState==4){var response=eclient.webrtc.http.responseText.split('[LEVEL1]');if(response[0]=='OK'&&event=='accept'&&response[3]) eclient.ga_event('Chat '+response[3],'Accept',config.account);else if(response[0]=='OK'&&event=='reject'&&response[2]) eclient.ga_event('Chat '+response[2],'Reject',config.account);if(response[0]=='ERROR') alert(response[1]);else if(response[0]=='OK'&&event=='accept'){if(window.opener) eclient.webrtc.script(response[2],response[3],'click');else eclient.xdc.set(config.master,{event:'webrtc',status:'active',type:'click',room:response[2],mode:response[3],lang:config.lang});}}};this.http.send(null);},close:function(){if(!this.http) this.http=jnf.xhr();this.http.abort();this.http.open('get',config.domain+'/'+config.account+'/client-embed/ajax.ims?session='+config.gateway+'&uniqid='+config.uniqid+'&language='+config.lang+'&tz_offset='+jnf.tz_offset()+(config.query?'&'+config.query:'')+'&action=webrtc&event=close&nocache='+jnf.nocache());this.http.onreadystatechange=function(){if(eclient.webrtc.http.readyState==4){var response=eclient.webrtc.http.responseText.split('[LEVEL1]');if(response[0]=='OK'&&response[2]) eclient.ga_event('Chat '+response[2],'Close',config.account);if(response[0]=='ERROR') alert(response[1]);}};this.http.send(null);}};